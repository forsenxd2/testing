<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo bảng chào Blanca City</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.5/dist/pizzip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.13/docxtemplater.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/file-saver/2.0.5/FileSaver.min.js"></script>
    <style>
        body { background: #f8f9fa; }
        .container { max-width: 600px; margin-top: 40px; }
        .qr-preview { margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4 text-center">Tạo bảng chào Blanca City</h1>
    <form id="chaoForm" class="step-container">
        <div class="mb-3">
            <label class="form-label">Chức vụ</label>
            <input type="text" class="form-control" id="chucVu" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Tên cán bộ</label>
            <input type="text" class="form-control" id="tenCanBo" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Số điện thoại (Zalo)</label>
            <input type="text" class="form-control" id="soDienThoai" required>
        </div>
        <button type="button" class="btn btn-primary" onclick="generateDocx()">Tạo file bảng chào (DOCX)</button>
        <a id="downloadLink" class="btn btn-success mt-3" style="display:none">Tải file đã điền</a>
    </form>
</div>
<script>
function generateDocx() {
    var chucVu = document.getElementById('chucVu').value;
    var tenCanBo = document.getElementById('tenCanBo').value;
    var soDienThoai = document.getElementById('soDienThoai').value;
    
    if (!chucVu || !tenCanBo || !soDienThoai) {
        alert('Vui lòng điền đầy đủ thông tin!');
        return;
    }
    
    console.log('Bắt đầu tải file DOCX...');
    
    fetch('pdf/bangchao.docx')
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response type:', response.type);
            if (!response.ok) {
                throw new Error('HTTP ' + response.status + ': ' + response.statusText);
            }
            return response.arrayBuffer();
        })
        .then(arrayBuffer => {
            console.log('File loaded, size:', arrayBuffer.byteLength, 'bytes');
            return processDoc(arrayBuffer);
        })
        .catch(error => {
            console.error('Lỗi khi tải file:', error);
            alert('Lỗi khi tải file template: ' + error.message);
        });
    
    function processDoc(arrayBuffer) {
        try {
            console.log('Tạo PizZip object...');
            var zip = new window.PizZip(arrayBuffer);
            console.log('PizZip created successfully');
            
            console.log('Tạo docxtemplater...');
            var doc = new window.docxtemplater(zip, { 
                paragraphLoop: true, 
                linebreaks: true 
            });
            console.log('Docxtemplater created successfully');
            
            console.log('Điền dữ liệu:', { chuc_vu: chucVu, ten_can_bo: tenCanBo, so_dien_thoai: soDienThoai });
            doc.setData({
                chuc_vu: chucVu,
                ten_can_bo: tenCanBo,
                so_dien_thoai: soDienThoai
            });
            
            console.log('Render document...');
            doc.render();
            console.log('Document rendered successfully');
            
            console.log('Generate output...');
            var out = doc.getZip().generate({ type: 'blob' });
            console.log('Output generated, size:', out.size, 'bytes');
            
            var link = document.getElementById('downloadLink');
            link.href = URL.createObjectURL(out);
            link.download = 'bang_chao_blanca.docx';
            link.style.display = 'inline-block';
            link.textContent = 'Tải file đã điền';
            console.log('Download link ready');
            
        } catch (error) {
            console.error('Lỗi chi tiết:', error);
            alert('Lỗi khi xử lý file: ' + error.message);
        }
    }
}
</script>
</body>
</html> 